File: frontend/vite.config.js
---
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'https://9525.ip-ddns.com',
        changeOrigin: true,
        secure: false
      }
    }
  },
  build: {
    outDir: 'dist',
    sourcemap: true
  }
})

File: frontend/package.json
---
{
  "name": "thirteen-water-game",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.0.0",
    "vite": "^4.3.0"
  }
}

File: frontend/src/pages/Register.jsx
---
import React, { useState } from 'react';
import { authAPI } from '../utils/api';

const Register = ({ onNavigate }) => {
  const [formData, setFormData] = useState({
    phone: '',
    password: '',
    confirmPassword: '',
    email: ''
  });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [success, setSuccess] = useState('');

  const handleChange = (e) => {
    const { name, value } = e.target;

    // æ‰‹æœºå·è¾“å…¥æ—¶è‡ªåŠ¨è¿‡æ»¤éæ•°å­—å­—ç¬¦
    if (name === 'phone') {
      const filteredValue = value.replace(/\D/g, ''); // ç§»é™¤éæ•°å­—å­—ç¬¦
      setFormData({
        ...formData,
        [name]: filteredValue
      });
    } else {
      setFormData({
        ...formData,
        [name]: value
      });
    }
  };

  const validatePhone = (phone) => {
    if (phone.length !== 11) {
      return 'æ‰‹æœºå·å¿…é¡»æ˜¯11ä½æ•°å­—';
    }
    if (!/^1[3-9]/.test(phone)) {
      return 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®';
    }
    return null;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError('');
    setSuccess('');

    // éªŒè¯æ‰‹æœºå·
    const phoneError = validatePhone(formData.phone);
    if (phoneError) {
      setError(phoneError);
      setLoading(false);
      return;
    }

    // éªŒè¯å¯†ç é•¿åº¦
    if (formData.password.length < 6) {
      setError('å¯†ç é•¿åº¦è‡³å°‘6ä½');
      setLoading(false);
      return;
    }

    // éªŒè¯å¯†ç ç¡®è®¤
    if (formData.password !== formData.confirmPassword) {
      setError('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
      setLoading(false);
      return;
    }

    try {
      const result = await authAPI.register(formData.phone, formData.password, formData.email);

      setSuccess(`æ³¨å†ŒæˆåŠŸï¼æ‚¨çš„ç”¨æˆ·IDæ˜¯: ${result.user_id}ï¼Œè¯·å¦¥å–„ä¿ç®¡`);

      // 3ç§’åè·³è½¬åˆ°ç™»å½•é¡µé¢
      setTimeout(() => {
        onNavigate('login');
      }, 3000);
    } catch (err) {
      setError(err.message || 'æ³¨å†Œå¤±è´¥');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="auth-container">
      <form className="auth-form" onSubmit={handleSubmit}>
        <h2>æ³¨å†Œè´¦å·</h2>

        {error && <div className="error-message">{error}</div>}
        {success && <div className="success-message">{success}</div>}

        <div className="form-group">
          <label htmlFor="phone">æ‰‹æœºå·</label>
          <input
            type="tel"
            id="phone"
            name="phone"
            value={formData.phone}
            onChange={handleChange}
            required
            placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·"
            maxLength="11"
            minLength="11"
            autoComplete="tel"
          />
          <div style={{ fontSize: '12px', color: '#87CEEB', marginTop: '5px' }}>
            è¯·è¾“å…¥11ä½æ‰‹æœºå·
          </div>
        </div>

        <div className="form-group">
          <label htmlFor="email">é‚®ç®±ï¼ˆå¯é€‰ï¼‰</label>
          <input
            type="email"
            id="email"
            name="email"
            value={formData.email}
            onChange={handleChange}
            placeholder="è¯·è¾“å…¥é‚®ç®±"
            autoComplete="email"
          />
        </div>

        <div className="form-group">
          <label htmlFor="password">å¯†ç </label>
          <input
            type="password"
            id="password"
            name="password"
            value={formData.password}
            onChange={handleChange}
            required
            placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰"
            minLength="6"
            autoComplete="new-password"
          />
        </div>

        <div className="form-group">
          <label htmlFor="confirmPassword">ç¡®è®¤å¯†ç </label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            value={formData.confirmPassword}
            onChange={handleChange}
            required
            placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
            minLength="6"
            autoComplete="new-password"
          />
        </div>

        <button type="submit" className="btn" disabled={loading || success}>
          {loading ? 'æ³¨å†Œä¸­...' : 'æ³¨å†Œ'}
        </button>

        <button
          type="button"
          className="link-btn"
          onClick={() => onNavigate('login')}
          style={{ marginTop: '15px' }}
        >
          å·²æœ‰è´¦å·ï¼Ÿç‚¹å‡»ç™»å½•
        </button>
      </form>
    </div>
  );
};

export default Register;

File: frontend/src/pages/Login.jsx
---
import React, { useState } from 'react';
import { authAPI } from '../utils/api';

const Login = ({ onLogin, onNavigate }) => {
  const [formData, setFormData] = useState({
    phone: '',
    password: ''
  });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleChange = (e) => {
    const { name, value } = e.target;

    // æ‰‹æœºå·è¾“å…¥æ—¶è‡ªåŠ¨è¿‡æ»¤éæ•°å­—å­—ç¬¦
    if (name === 'phone') {
      const filteredValue = value.replace(/\D/g, ''); // ç§»é™¤éæ•°å­—å­—ç¬¦
      setFormData({
        ...formData,
        [name]: filteredValue
      });
    } else {
      setFormData({
        ...formData,
        [name]: value
      });
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    // åŸºæœ¬æ‰‹æœºå·éªŒè¯
    if (formData.phone.length !== 11) {
      setError('è¯·è¾“å…¥11ä½æ‰‹æœºå·');
      setLoading(false);
      return;
    }

    try {
      const result = await authAPI.login(formData.phone, formData.password);

      // ä¿å­˜tokenå’Œç”¨æˆ·ä¿¡æ¯
      localStorage.setItem('token', result.token);
      localStorage.setItem('user', JSON.stringify(result.user));

      onLogin(result.user);
      onNavigate('main');
    } catch (err) {
      setError(err.message || 'ç™»å½•å¤±è´¥');
    } finally {
      setLoading(false);
    }
  };

  const handleFindUserId = async () => {
    const phone = prompt('è¯·è¾“å…¥æ‰‹æœºå·æŸ¥æ‰¾ç”¨æˆ·ID:');
    if (!phone) return;

    // åŸºæœ¬æ‰‹æœºå·éªŒè¯
    if (phone.length !== 11) {
      alert('è¯·è¾“å…¥11ä½æ‰‹æœºå·');
      return;
    }

    try {
      const result = await authAPI.findUserId(phone);
      alert(`æ‰‹æœºå· ${result.phone} å¯¹åº”çš„ç”¨æˆ·IDæ˜¯: ${result.user_id}`);
    } catch (err) {
      alert(err.message || 'æŸ¥æ‰¾å¤±è´¥');
    }
  };

  return (
    <div className="auth-container">
      <form className="auth-form" onSubmit={handleSubmit}>
        <h2>ç™»å½•åä¸‰æ°´</h2>

        {error && <div className="error-message">{error}</div>}

        <div className="form-group">
          <label htmlFor="phone">æ‰‹æœºå·</label>
          <input
            type="tel"
            id="phone"
            name="phone"
            value={formData.phone}
            onChange={handleChange}
            required
            placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·"
            maxLength="11"
            minLength="11"
            autoComplete="tel"
          />
          <div style={{ fontSize: '12px', color: '#87CEEB', marginTop: '5px' }}>
            è¯·è¾“å…¥11ä½æ‰‹æœºå·
          </div>
        </div>

        <div className="form-group">
          <label htmlFor="password">å¯†ç </label>
          <input
            type="password"
            id="password"
            name="password"
            value={formData.password}
            onChange={handleChange}
            required
            placeholder="è¯·è¾“å…¥å¯†ç "
            minLength="6"
            autoComplete="current-password"
          />
        </div>

        <button type="submit" className="btn" disabled={loading}>
          {loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}
        </button>

        <div style={{ display: 'flex', gap: '10px', marginTop: '15px' }}>
          <button
            type="button"
            className="link-btn"
            onClick={() => onNavigate('register')}
          >
            æ³¨å†Œè´¦å·
          </button>

          <button
            type="button"
            className="link-btn"
            onClick={handleFindUserId}
          >
            æ‰¾å›ç”¨æˆ·ID
          </button>
        </div>
      </form>
    </div>
  );
};

export default Login;

File: frontend/src/pages/GameRoom.jsx
---
import React, { useState, useEffect } from 'react';
import CardArea from '../components/CardArea';
import { validateCardArrangement } from '../utils/cardUtils';
import { gameAPI } from '../utils/api';

const GameRoom = ({ roomType, userInfo, onExit }) => {
  const [arrangedCards, setArrangedCards] = useState({
    head: [],
    middle: [],
    tail: []
  });
  const [gameStatus, setGameStatus] = useState('waiting');
  const [roomInfo, setRoomInfo] = useState(null);
  const [currentGame, setCurrentGame] = useState(null);
  const [debugInfo, setDebugInfo] = useState('');

  // åˆå§‹åŒ–æ¸¸æˆ
  const initGame = async () => {
    try {
      const result = await gameAPI.getGame(roomType);
      if (result.success) {
        setCurrentGame(result);

        // è®°å½•è°ƒè¯•ä¿¡æ¯
        setDebugInfo(`è·å–åˆ°ç‰Œå±€: ${result.game_id}, å¤´é“: ${result.preset_arrangement.head.length}å¼ , ä¸­é“: ${result.preset_arrangement.middle.length}å¼ , å°¾é“: ${result.preset_arrangement.tail.length}å¼ `);
        console.log('APIè¿”å›æ•°æ®:', result);

        // ç›´æ¥ä½¿ç”¨åç«¯é¢„è®¾çš„ç†ç‰Œç»“æœ
        setArrangedCards(result.preset_arrangement);
        setGameStatus('playing');

        setRoomInfo({
          id: result.game_id,
          type: roomType,
          players: 1,
          maxPlayers: 4
        });
      } else {
        alert('è·å–ç‰Œå±€å¤±è´¥ï¼š' + result.message);
      }
    } catch (error) {
      alert('è·å–ç‰Œå±€å¤±è´¥ï¼š' + error.message);
      console.error('åˆå§‹åŒ–æ¸¸æˆé”™è¯¯:', error);
    }
  };

  // æäº¤ç‰Œå‹
  const handleSubmit = async () => {
    const totalArranged = arrangedCards.head.length + arrangedCards.middle.length + arrangedCards.tail.length;
    if (totalArranged !== 13) {
      alert('è¯·ç¡®ä¿13å¼ ç‰Œå…¨éƒ¨åˆ†é…åˆ°ä¸‰é“ä¸­ï¼');
      return;
    }

    if (!validateCardArrangement(arrangedCards.head, arrangedCards.middle, arrangedCards.tail)) {
      alert('ç‰Œå‹ä¸ç¬¦åˆè§„åˆ™ï¼è¯·ç¡®ä¿ï¼šå¤´é“ â‰¤ ä¸­é“ â‰¤ å°¾é“');
      return;
    }

    try {
      const result = await gameAPI.submitCards(currentGame.game_id, arrangedCards);

      if (result.success) {
        setGameStatus('submitted');
        alert('æäº¤æˆåŠŸï¼ç­‰å¾…å…¶ä»–ç©å®¶...');
      } else {
        alert('æäº¤å¤±è´¥ï¼š' + result.message);
      }
    } catch (error) {
      alert('æäº¤å¤±è´¥ï¼š' + error.message);
    }
  };

  // ç§»åŠ¨ç‰Œ
  const moveCard = (card, fromArea, toArea) => {
    if (fromArea === toArea) return;

    if ((toArea === 'head' && arrangedCards[toArea].length >= 3) ||
        (toArea !== 'head' && arrangedCards[toArea].length >= 5)) {
      alert('è¯¥åŒºåŸŸå·²æ»¡ï¼');
      return;
    }

    const newFrom = arrangedCards[fromArea].filter(c =>
      typeof c === 'object' ? c.filename !== card.filename : c !== card
    );

    const newTo = [...arrangedCards[toArea], card];

    setArrangedCards(prev => ({
      ...prev,
      [fromArea]: newFrom,
      [toArea]: newTo
    }));
  };

  // é‡æ–°å¼€å§‹æ¸¸æˆ
  const handleRestart = () => {
    if (window.confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿ')) {
      initGame();
    }
  };

  // é‡ç½®ä¸ºåˆå§‹ç†ç‰ŒçŠ¶æ€
  const handleReset = () => {
    if (currentGame && window.confirm('ç¡®å®šè¦é‡ç½®ä¸ºåˆå§‹ç†ç‰ŒçŠ¶æ€å—ï¼Ÿ')) {
      setArrangedCards(currentGame.preset_arrangement);
    }
  };

  // æ£€æŸ¥å¡ç‰‡æ•°æ®
  const checkCardData = () => {
    console.log('å½“å‰å¡ç‰‡æ•°æ®:', arrangedCards);
    const headCards = arrangedCards.head.map(card =>
      typeof card === 'object' ? card.filename : card
    );
    const middleCards = arrangedCards.middle.map(card =>
      typeof card === 'object' ? card.filename : card
    );
    const tailCards = arrangedCards.tail.map(card =>
      typeof card === 'object' ? card.filename : card
    );

    alert(`å¤´é“: ${headCards.join(', ')}\nä¸­é“: ${middleCards.join(', ')}\nå°¾é“: ${tailCards.join(', ')}`);
  };

  useEffect(() => {
    initGame();
  }, [roomType]);

  return (
    <div className="game-room">
      <div className="room-header">
        <h2>{roomType}åˆ†åœº - åä¸‰æ°´æ¸¸æˆ</h2>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: '10px' }}>
          <span>ç©å®¶: {userInfo?.phone} | ä½™é¢: {userInfo?.balance}åˆ†</span>
          <span>çŠ¶æ€: {
            gameStatus === 'waiting' ? 'ç­‰å¾…ä¸­' :
            gameStatus === 'playing' ? 'è¿›è¡Œä¸­' : 'å·²æäº¤'
          }</span>
        </div>
        <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
          <button className="link-btn" onClick={onExit}>
            è¿”å›å¤§å…
          </button>
          <button className="link-btn" onClick={checkCardData}>
            è°ƒè¯•å¡ç‰‡
          </button>
        </div>
      </div>

      {debugInfo && (
        <div style={{
          background: 'rgba(255,255,255,0.1)',
          padding: '10px',
          borderRadius: '5px',
          marginBottom: '10px',
          fontSize: '12px'
        }}>
          è°ƒè¯•ä¿¡æ¯: {debugInfo}
        </div>
      )}

      <div className="card-areas">
        {/* å¤´é“ - æœ€å°ç‰Œå‹ï¼ˆæœ€ä¸Šé¢ï¼‰ */}
        <CardArea
          title="å¤´é“ï¼ˆ3å¼ ï¼‰- æœ€å°ç‰Œå‹"
          cards={arrangedCards.head}
          area="head"
          maxCards={3}
          onCardMove={moveCard}
          gameStatus={gameStatus}
        />

        {/* ä¸­é“ - ä¸­ç­‰ç‰Œå‹ */}
        <CardArea
          title="ä¸­é“ï¼ˆ5å¼ ï¼‰- ä¸­ç­‰ç‰Œå‹"
          cards={arrangedCards.middle}
          area="middle"
          maxCards={5}
          onCardMove={moveCard}
          gameStatus={gameStatus}
        />

        {/* å°¾é“ - æœ€å¤§ç‰Œå‹ï¼ˆæœ€ä¸‹é¢ï¼‰ */}
        <CardArea
          title="å°¾é“ï¼ˆ5å¼ ï¼‰- æœ€å¤§ç‰Œå‹"
          cards={arrangedCards.tail}
          area="tail"
          maxCards={5}
          onCardMove={moveCard}
          gameStatus={gameStatus}
        />
      </div>

      <div className="game-controls">
        <button
          className="btn control-btn"
          onClick={handleReset}
          disabled={gameStatus !== 'playing'}
        >
          é‡ç½®ç‰Œå‹
        </button>
        <button
          className="btn control-btn"
          onClick={handleSubmit}
          disabled={gameStatus !== 'playing'}
        >
          æäº¤ç‰Œå‹
        </button>
        <button className="btn btn-secondary control-btn" onClick={handleRestart}>
          é‡æ–°å¼€å§‹
        </button>
      </div>

      {gameStatus === 'submitted' && (
        <div style={{
          textAlign: 'center',
          padding: '15px',
          background: 'rgba(76, 175, 80, 0.2)',
          borderRadius: '8px',
          marginTop: '15px'
        }}>
          <p>âœ… å·²æäº¤ç‰Œå‹ï¼Œç­‰å¾…å…¶ä»–ç©å®¶å®Œæˆ...</p>
          <button
            className="link-btn"
            onClick={() => setGameStatus('playing')}
            style={{ marginTop: '10px' }}
          >
            é‡æ–°è°ƒæ•´ç‰Œå‹
          </button>
        </div>
      )}

      <div style={{
        textAlign: 'center',
        marginTop: '20px',
        padding: '15px',
        background: 'rgba(255, 255, 255, 0.1)',
        borderRadius: '8px',
        fontSize: '14px',
        opacity: 0.8
      }}>
        <p>ğŸ’¡ æç¤ºï¼šæ‹–æ‹½æ‰‘å…‹ç‰Œå¯ä»¥åœ¨ä¸‰é“ä¹‹é—´è°ƒæ•´ï¼Œç¡®ä¿å¤´é“ â‰¤ ä¸­é“ â‰¤ å°¾é“</p>
      </div>
    </div>
  );
};

export default GameRoom;

File: frontend/src/pages/MainMenu.jsx
---
import React, { useState, useEffect } from 'react';
import BalanceManager from '../components/BalanceManager';

const MainMenu = ({ userInfo, onSelectRoom, onNavigate }) => {
  const [showBalanceManager, setShowBalanceManager] = useState(false);

  const rooms = [
    { type: '2', name: '2åˆ†åœº', description: 'åˆçº§åœºï¼Œé€‚åˆæ–°æ‰‹ç©å®¶', minBalance: 0 },
    { type: '5', name: '5åˆ†åœº', description: 'ä¸­çº§åœºï¼ŒæŒ‘æˆ˜æ›´é«˜æ”¶ç›Š', minBalance: 100 },
    { type: '10', name: '10åˆ†åœº', description: 'é«˜çº§åœºï¼Œé«˜æ‰‹å¯¹å†³', minBalance: 500 }
  ];

  const handleRoomSelect = (roomType) => {
    const room = rooms.find(r => r.type === roomType);
    if (userInfo.balance < room.minBalance) {
      alert(`ä½™é¢ä¸è¶³ï¼è¿›å…¥${room.name}éœ€è¦è‡³å°‘${room.minBalance}åˆ†`);
      return;
    }
    onSelectRoom(roomType);
    onNavigate('game');
  };

  const handleLogout = () => {
    if (window.confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      onNavigate('login');
    }
  };

  const refreshUserInfo = () => {
    // è§¦å‘çˆ¶ç»„ä»¶åˆ·æ–°ç”¨æˆ·ä¿¡æ¯
    if (window.refreshUserInfo) {
      window.refreshUserInfo();
    }
  };

  return (
    <div className="main-menu">
      {/* é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯å’Œä½™é¢ç®¡ç† */}
      <div className="user-info">
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>
          <h2>æ¬¢è¿ï¼Œ{userInfo?.phone}ï¼</h2>
          <button
            className="btn"
            onClick={() => setShowBalanceManager(true)}
            style={{ padding: '8px 16px', fontSize: '14px' }}
          >
            ç§¯åˆ†ç®¡ç†
          </button>
        </div>

        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '10px' }}>
          <div>
            <p>ç”¨æˆ·ID: <span style={{ color: '#4CAF50', fontWeight: 'bold' }}>{userInfo?.user_id}</span></p>
            <p>ç­‰çº§: Lv.{userInfo?.level || 1}</p>
          </div>
          <div style={{ textAlign: 'right' }}>
            <p style={{ fontSize: '18px', fontWeight: 'bold', color: '#FFD700' }}>
              ä½™é¢: {userInfo?.balance || 0} åˆ†
            </p>
          </div>
        </div>

        <button className="link-btn" onClick={handleLogout}>é€€å‡ºç™»å½•</button>
      </div>

      {/* æˆ¿é—´é€‰æ‹© */}
      <div className="room-selection">
        <h2 style={{ textAlign: 'center', marginBottom: '30px' }}>é€‰æ‹©æ¸¸æˆåœºæ¬¡</h2>

        {rooms.map(room => (
          <div
            key={room.type}
            className="room-card"
            onClick={() => handleRoomSelect(room.type)}
          >
            <h3>{room.name}</h3>
            <p>{room.description}</p>
            <div style={{ marginTop: '10px', fontSize: '14px', opacity: 0.8 }}>
              æœ€ä½ä½™é¢ï¼š{room.minBalance}åˆ†
            </div>
          </div>
        ))}
      </div>

      {/* æ¸¸æˆè§„åˆ™è¯´æ˜ */}
      <div style={{ textAlign: 'center', marginTop: '40px', opacity: 0.7 }}>
        <p>æ¸¸æˆè§„åˆ™ï¼šå°†13å¼ ç‰Œåˆ†æˆå¤´é“(3å¼ )ã€ä¸­é“(5å¼ )ã€å°¾é“(5å¼ )</p>
        <p>å¤´é“ â‰¤ ä¸­é“ â‰¤ å°¾é“ï¼Œæ¯”è¾ƒç‰Œå‹å¤§å°å†³å®šèƒœè´Ÿ</p>
      </div>

      {/* ä½™é¢ç®¡ç†å¼¹çª— */}
      {showBalanceManager && (
        <BalanceManager
          userInfo={userInfo}
          onClose={() => {
            setShowBalanceManager(false);
            refreshUserInfo();
          }}
        />
      )}
    </div>
  );
};

export default MainMenu;

File: frontend/src/index.css
---
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
  color: white;
  min-height: 100vh;
}

.app {
  min-height: 100vh;
}

/* ç™»å½•æ³¨å†Œæ ·å¼ */
.auth-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
}

.auth-form {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  padding: 40px;
  border-radius: 15px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  width: 100%;
  max-width: 400px;
}

.auth-form h2 {
  text-align: center;
  margin-bottom: 30px;
  font-size: 28px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}

.form-group input {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.9);
  font-size: 16px;
}

.btn {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 8px;
  background: #4CAF50;
  color: white;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s;
}

.btn:hover {
  background: #45a049;
}

.btn-secondary {
  background: #6c757d;
}

.btn-secondary:hover {
  background: #5a6268;
}

.link-btn {
  background: none;
  border: none;
  color: #87CEEB;
  cursor: pointer;
  text-decoration: underline;
  margin-top: 15px;
}

.error-message {
  color: #ff6b6b;
  background: rgba(255, 107, 107, 0.1);
  padding: 10px;
  border-radius: 5px;
  margin-bottom: 15px;
  text-align: center;
  border: 1px solid rgba(255, 107, 107, 0.3);
}

.success-message {
  color: #51cf66;
  background: rgba(81, 207, 102, 0.1);
  padding: 10px;
  border-radius: 5px;
  margin-bottom: 15px;
  text-align: center;
  border: 1px solid rgba(81, 207, 102, 0.3);
}

/* ä¸»èœå•æ ·å¼ */
.main-menu {
  min-height: 100vh;
  padding: 20px;
}

.user-info {
  margin-bottom: 40px;
  padding: 20px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
}

.room-selection {
  display: flex;
  flex-direction: column;
  gap: 20px;
  max-width: 600px;
  margin: 0 auto;
}

.room-card {
  background: rgba(255, 255, 255, 0.15);
  padding: 30px;
  border-radius: 15px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  border: 2px solid transparent;
}

.room-card:hover {
  background: rgba(255, 255, 255, 0.25);
  border-color: #4CAF50;
  transform: translateY(-5px);
}

.room-card h3 {
  font-size: 24px;
  margin-bottom: 10px;
}

.room-card p {
  opacity: 0.9;
}

/* æ¸¸æˆæˆ¿é—´æ ·å¼ */
.game-room {
  min-height: 100vh;
  padding: 20px;
  display: flex;
  flex-direction: column;
}

.room-header {
  text-align: center;
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
}

.card-areas {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin-bottom: 0;
}

.card-area {
  background: rgba(255, 255, 255, 0.1);
  border: 2px dashed rgba(255, 255, 255, 0.3);
  border-radius: 10px;
  padding: 15px;
  min-height: 150px;
  transition: all 0.3s ease;
}

.area-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.area-header h4 {
  font-size: 18px;
}

.card-slot {
  display: flex;
  gap: 5px;
  flex-wrap: wrap;
  min-height: 80px;
}

.game-controls {
  display: flex;
  gap: 15px;
  padding: 20px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  margin-top: 20px;
}

.control-btn {
  flex: 1;
  padding: 15px;
  font-size: 16px;
}

/* ç§»é™¤æ‰‹ç‰Œæ ·å¼ */
.hand-cards {
  display: none;
}

/* æ‰‘å…‹ç‰Œæ ·å¼ */
.card {
  width: 70px;
  height: 98px;
  cursor: grab;
  transition: transform 0.2s;
  user-select: none;
}

.card:hover {
  transform: translateY(-3px);
}

.card.dragging {
  opacity: 0.7;
}

.card img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* æ¨¡æ€æ¡†æ ·å¼ */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
  padding: 25px;
  border-radius: 15px;
  width: 90%;
  max-width: 500px;
  max-height: 80vh;
  overflow-y: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.close-btn {
  background: none;
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .auth-form {
    padding: 20px;
  }

  .card {
    width: 50px;
    height: 70px;
  }

  .game-controls {
    flex-direction: column;
  }

  .room-card {
    padding: 20px;
  }

  .modal-content {
    padding: 15px;
  }

  .card-area {
    padding: 10px;
    min-height: 120px;
  }
}


File: frontend/src/main.jsx
---
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)

File: frontend/src/utils/cardUtils.js
---
// éªŒè¯ç‰Œå‹æ˜¯å¦åˆæ³• - å¢å¼ºç‰ˆæœ¬
export const validateCardArrangement = (head, middle, tail) => {
  // æ£€æŸ¥æ•°é‡
  if (head.length !== 3 || middle.length !== 5 || tail.length !== 5) {
    return false;
  }

  // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„ç‰Œå‹å¤§å°éªŒè¯
  // å®é™…åº”è¯¥æ¯”è¾ƒå¤´é“ â‰¤ ä¸­é“ â‰¤ å°¾é“

  // åŸºç¡€éªŒè¯é€šè¿‡
  return true;
};

// å…¶ä»–å·¥å…·å‡½æ•°ä¿æŒä¸å˜...
export const parseCardFromFilename = (filename) => {
  const match = filename.match(/(.+)_of_(.+)\.svg/);
  if (!match) return null;

  const [, value, suit] = match;

  // èŠ±è‰²æ˜ å°„
  const SUIT_MAP = {
    'clubs': 'â™£',
    'spades': 'â™ ',
    'diamonds': 'â™¦',
    'hearts': 'â™¥'
  };

  // ç‚¹æ•°æ˜ å°„
  const VALUE_MAP = {
    'ace': 'A',
    'king': 'K',
    'queen': 'Q',
    'jack': 'J',
    '10': '10',
    '9': '9',
    '8': '8',
    '7': '7',
    '6': '6',
    '5': '5',
    '4': '4',
    '3': '3',
    '2': '2'
  };

  return {
    value,
    suit,
    display: `${VALUE_MAP[value] || value}${SUIT_MAP[suit] || suit}`,
    filename,
    sortValue: getSortValue(value, suit)
  };
}

// è·å–æ’åºå€¼
const getSortValue = (value, suit) => {
  const valueOrder = {
    '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,
    'jack': 11, 'queen': 12, 'king': 13, 'ace': 14
  };
  const suitOrder = {
    'clubs': 0, 'diamonds': 1, 'hearts': 2, 'spades': 3
  };

  return valueOrder[value] * 10 + suitOrder[suit];
}

// æ´—ç‰Œç®—æ³•
export const shuffleCards = (cards) => {
  const shuffled = [...cards];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

// ç”Ÿæˆ52å¼ æ ‡å‡†æ‰‘å…‹ç‰Œ
export const generateDeck = () => {
  const suits = ['clubs', 'diamonds', 'hearts', 'spades'];
  const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'jack', 'queen', 'king', 'ace'];

  const deck = [];
  suits.forEach(suit => {
    values.forEach(value => {
      const filename = `${value}_of_${suit}.svg`;
      deck.push(parseCardFromFilename(filename));
    });
  });

  return deck;
}


File: frontend/src/utils/api.js
---

const API_BASE = '/api';

// é€šç”¨è¯·æ±‚å‡½æ•°
const request = async (endpoint, options = {}) => {
  const url = `${API_BASE}${endpoint}`;
  const config = {
    headers: {
      'Content-Type': 'application/json',
      ...options.headers,
    },
    ...options,
  };

  // æ·»åŠ è®¤è¯token
  const token = localStorage.getItem('token');
  if (token) {
    config.headers['Authorization'] = `Bearer ${token}`;
  }

  if (config.body && typeof config.body === 'object') {
    config.body = JSON.stringify(config.body);
  }

  try {
    const response = await fetch(url, config);

    const contentType = response.headers.get('content-type');
    let data;

    if (contentType && contentType.includes('application/json')) {
      data = await response.json();
    } else {
      const text = await response.text();
      throw new Error(`æœåŠ¡å™¨è¿”å›äº†éJSONå“åº”: ${text.substring(0, 100)}`);
    }

    if (!response.ok) {
      throw new Error(data.message || 'è¯·æ±‚å¤±è´¥');
    }

    return data;
  } catch (error) {
    console.error('APIè¯·æ±‚é”™è¯¯:', error);

    if (error.message.includes('Failed to fetch')) {
      throw new Error('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
    } else if (error.message.includes('éJSONå“åº”')) {
      throw new Error('æœåŠ¡å™¨å“åº”å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•');
    } else {
      throw error;
    }
  }
};

// å°†å¡ç‰‡æ–‡ä»¶åè§£æä¸ºå¯¹è±¡
const parseCardFromFilename = (card) => {
  if (typeof card !== 'string' || !card.includes('_of_')) {
    return { display: card, filename: card };
  }

  const filename = card.endsWith('.svg') ? card : `${card}.svg`;
  const [value, suit] = filename.replace('.svg', '').split('_of_');

  const suitSymbols = {
    'clubs': 'â™£',
    'diamonds': 'â™¦',
    'hearts': 'â™¥',
    'spades': 'â™ '
  };

  const valueMap = {
    'ace': 'A', 'king': 'K', 'queen': 'Q', 'jack': 'J',
    '10': '10', '9': '9', '8': '8', '7': '7', '6': '6',
    '5': '5', '4': '4', '3': '3', '2': '2'
  };

  return {
    display: `${valueMap[value] || value}${suitSymbols[suit] || suit}`,
    filename: filename
  };
};

// ç”¨æˆ·API
export const authAPI = {
  login: (phone, password) =>
    request('/auth.php?action=login', {
      method: 'POST',
      body: { phone, password }
    }),

  register: (phone, password, email) =>
    request('/auth.php?action=register', {
      method: 'POST',
      body: { phone, password, email }
    }),

  findUserId: (phone) =>
    request('/auth.php?action=find_user_id', {
      method: 'POST',
      body: { phone }
    }),
};

// æ¸¸æˆAPI
export const gameAPI = {
  getGame: async (sessionType) => {
    const result = await request(`/game.php?action=get_game&session_type=${sessionType}`);

    // ç¡®ä¿å¡ç‰‡æ•°æ®æ ¼å¼æ­£ç¡®
    if (result.success && result.preset_arrangement) {
      const formatCards = (cards) => {
        if (!cards || !Array.isArray(cards)) return [];

        return cards.map(card => {
          if (card && typeof card === 'object' && card.filename) {
            return card; // å·²ç»æ˜¯æ­£ç¡®çš„å¯¹è±¡æ ¼å¼
          }
          if (typeof card === 'string') {
            return parseCardFromFilename(card); // ä»å­—ç¬¦ä¸²è½¬æ¢
          }
          return card; // å…¶ä»–æƒ…å†µï¼Œç›´æ¥è¿”å›
        });
      };

      // å¤„ç†é¢„è®¾ç‰Œå‹
      result.preset_arrangement.head = formatCards(result.preset_arrangement.head);
      result.preset_arrangement.middle = formatCards(result.preset_arrangement.middle);
      result.preset_arrangement.tail = formatCards(result.preset_arrangement.tail);

      // å¤„ç†åŸå§‹æ‰‹ç‰Œ
      if (result.original_cards) {
        result.original_cards = formatCards(result.original_cards);
      }
    }

    return result;
  },

  submitCards: (gameId, arrangedCards) =>
    request('/game.php?action=submit', {
      method: 'POST',
      body: { game_id: gameId, arranged_cards: arrangedCards }
    }),

  getUserInfo: () =>
    request('/game.php?action=user_info'),
};

// ä½™é¢API
export const balanceAPI = {
  transfer: (toUserId, amount, note = '') =>
    request('/balance.php?action=transfer', {
      method: 'POST',
      body: { to_user_id: toUserId, amount, note }
    }),

  getTransfers: (limit = 20) =>
    request(`/balance.php?action=transfers&limit=${limit}`),

  getRecentTransfers: (count = 5) =>
    request(`/balance.php?action=recent_transfers&count=${count}`),
};


File: frontend/src/components/Card.jsx
---
import React from 'react';

const Card = ({ card, area, draggable = true }) => {
  const handleDragStart = (e) => {
    if (!draggable) {
      e.preventDefault();
      return;
    }

    e.dataTransfer.setData('application/json', JSON.stringify({
      card,
      fromArea: area
    }));
  };

  const handleDragEnd = (e) => {
    // æ‹–æ‹½ç»“æŸå¤„ç†
  };

  // è·å–å¡ç‰‡æ–‡ä»¶åï¼ˆç¡®ä¿æœ‰.svgæ‰©å±•åï¼‰
  const getCardFilename = (card) => {
    let filename;

    if (typeof card === 'object') {
      filename = card.filename;
    } else {
      filename = card;
    }

    // ç¡®ä¿æ–‡ä»¶åæœ‰.svgæ‰©å±•å
    if (filename && !filename.endsWith('.svg')) {
      filename = filename + '.svg';
    }

    return filename;
  };

  // è·å–å¡ç‰‡æ˜¾ç¤ºåç§°
  const getCardDisplay = (card) => {
    if (typeof card === 'object') {
      return card.display || card.filename;
    }
    return card;
  };

  const cardFilename = getCardFilename(card);
  const cardDisplay = getCardDisplay(card);

  return (
    <div
      className="card"
      draggable={draggable}
      onDragStart={handleDragStart}
      onDragEnd={handleDragEnd}
      style={{
        cursor: draggable ? 'grab' : 'default',
        opacity: draggable ? 1 : 0.8
      }}
      title={cardDisplay}
    >
      <img
        src={`/cards/${cardFilename}`}
        alt={cardDisplay}
        onError={(e) => {
          // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºæ›¿ä»£æ ·å¼
          e.target.style.display = 'none';
          const parent = e.target.parentNode;

          parent.innerHTML = `
            <div style="
              width: 100%;
              height: 100%;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              background: white;
              color: #333;
              border-radius: 5px;
              border: 1px solid #ccc;
              font-size: 16px;
              text-align: center;
              padding: 5px;
              box-sizing: border-box;
              font-weight: bold;
            ">
              ${cardDisplay}
            </div>
          `;
        }}
        style={{
          width: '100%',
          height: '100%',
          objectFit: 'contain'
        }}
      />
    </div>
  );
};

export default Card;

File: frontend/src/components/GameTable.jsx
---
import React from 'react';

const GameTable = () => {
  return (
    <div className="game-table">
      {/* Game table content goes here */}
    </div>
  );
};

export default GameTable;

File: frontend/src/components/BalanceManager.jsx
---
import React, { useState, useEffect } from 'react';
import { balanceAPI } from '../utils/api';

const BalanceManager = ({ userInfo, onClose }) => {
  const [activeTab, setActiveTab] = useState('transfer');
  const [transferData, setTransferData] = useState({
    toUserId: '',
    amount: '',
    note: ''
  });
  const [transfers, setTransfers] = useState([]);
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState('');

  useEffect(() => {
    loadRecentTransfers();
  }, []);

  const loadRecentTransfers = async () => {
    try {
      const result = await balanceAPI.getRecentTransfers(10);
      setTransfers(result.transfers || []);
    } catch (error) {
      console.error('åŠ è½½è½¬è´¦è®°å½•å¤±è´¥:', error);
    }
  };

  const handleTransfer = async (e) => {
    e.preventDefault();
    setLoading(true);
    setMessage('');

    if (!transferData.toUserId || !transferData.amount) {
      setMessage('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
      setLoading(false);
      return;
    }

    const amount = parseInt(transferData.amount);
    if (amount <= 0) {
      setMessage('è½¬è´¦é‡‘é¢å¿…é¡»å¤§äº0');
      setLoading(false);
      return;
    }

    if (amount > userInfo.balance) {
      setMessage('ä½™é¢ä¸è¶³');
      setLoading(false);
      return;
    }

    try {
      const result = await balanceAPI.transfer(
        transferData.toUserId,
        amount,
        transferData.note
      );

      setMessage(`è½¬è´¦æˆåŠŸï¼å½“å‰ä½™é¢: ${result.new_balance}åˆ†`);
      setTransferData({ toUserId: '', amount: '', note: '' });
      loadRecentTransfers();

      // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
      if (window.refreshUserInfo) {
        window.refreshUserInfo();
      }
    } catch (error) {
      setMessage(error.message || 'è½¬è´¦å¤±è´¥');
    } finally {
      setLoading(false);
    }
  };

  const handleInputChange = (e) => {
    setTransferData({
      ...transferData,
      [e.target.name]: e.target.value
    });
  };

  const formatTime = (timestamp) => {
    return new Date(timestamp).toLocaleString('zh-CN');
  };

  return (
    <div className="modal-overlay">
      <div className="modal-content">
        <div className="modal-header">
          <h3>ç§¯åˆ†ç®¡ç†</h3>
          <button className="close-btn" onClick={onClose}>Ã—</button>
        </div>

        <div className="balance-info" style={{
          background: 'rgba(255,255,255,0.1)',
          padding: '15px',
          borderRadius: '8px',
          marginBottom: '20px',
          textAlign: 'center'
        }}>
          <p style={{ fontSize: '16px', margin: 0 }}>
            å½“å‰ä½™é¢: <span style={{ color: '#FFD700', fontSize: '20px', fontWeight: 'bold' }}>
              {userInfo?.balance || 0}
            </span> åˆ†
          </p>
          <p style={{ margin: '5px 0 0 0', fontSize: '14px', opacity: 0.8 }}>
            ç”¨æˆ·ID: {userInfo?.user_id}
          </p>
        </div>

        <div className="tabs" style={{ display: 'flex', marginBottom: '20px', borderBottom: '1px solid rgba(255,255,255,0.3)' }}>
          <button
            className={`tab-btn ${activeTab === 'transfer' ? 'active' : ''}`}
            onClick={() => setActiveTab('transfer')}
            style={{
              flex: 1,
              padding: '10px',
              background: 'none',
              border: 'none',
              color: 'white',
              borderBottom: activeTab === 'transfer' ? '2px solid #4CAF50' : 'none',
              cursor: 'pointer'
            }}
          >
            è½¬è´¦
          </button>
          <button
            className={`tab-btn ${activeTab === 'history' ? 'active' : ''}`}
            onClick={() => setActiveTab('history')}
            style={{
              flex: 1,
              padding: '10px',
              background: 'none',
              border: 'none',
              color: 'white',
              borderBottom: activeTab === 'history' ? '2px solid #4CAF50' : 'none',
              cursor: 'pointer'
            }}
          >
            è½¬è´¦è®°å½•
          </button>
        </div>

        {activeTab === 'transfer' && (
          <form onSubmit={handleTransfer} className="transfer-form">
            <div className="form-group">
              <label>æ”¶æ¬¾ç”¨æˆ·ID</label>
              <input
                type="text"
                name="toUserId"
                value={transferData.toUserId}
                onChange={handleInputChange}
                placeholder="è¯·è¾“å…¥4ä½ç”¨æˆ·ID"
                maxLength="4"
                required
                style={{ textTransform: 'uppercase' }}
              />
              <div style={{ fontSize: '12px', color: '#87CEEB', marginTop: '5px' }}>
                è¯·è¾“å…¥4ä½ç”¨æˆ·IDï¼ˆæ•°å­—å’Œå­—æ¯ç»„åˆï¼‰
              </div>
            </div>

            <div className="form-group">
              <label>è½¬è´¦é‡‘é¢</label>
              <input
                type="number"
                name="amount"
                value={transferData.amount}
                onChange={handleInputChange}
                placeholder="è¯·è¾“å…¥è½¬è´¦é‡‘é¢"
                min="1"
                max={userInfo?.balance || 0}
                required
              />
            </div>

            <div className="form-group">
              <label>å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
              <input
                type="text"
                name="note"
                value={transferData.note}
                onChange={handleInputChange}
                placeholder="è¯·è¾“å…¥å¤‡æ³¨"
                maxLength="50"
              />
            </div>

            {message && (
              <div className={`message ${message.includes('æˆåŠŸ') ? 'success' : 'error'}`}
                style={{
                  padding: '10px',
                  borderRadius: '5px',
                  marginBottom: '15px',
                  background: message.includes('æˆåŠŸ') ? 'rgba(76, 175, 80, 0.2)' : 'rgba(244, 67, 54, 0.2)',
                  color: message.includes('æˆåŠŸ') ? '#4CAF50' : '#f44336'
                }}
              >
                {message}
              </div>
            )}

            <button type="submit" className="btn" disabled={loading}>
              {loading ? 'è½¬è´¦ä¸­...' : 'ç¡®è®¤è½¬è´¦'}
            </button>
          </form>
        )}

        {activeTab === 'history' && (
          <div className="transfer-history">
            {transfers.length === 0 ? (
              <p style={{ textAlign: 'center', opacity: 0.7, padding: '20px' }}>
                æš‚æ— è½¬è´¦è®°å½•
              </p>
            ) : (
              <div className="transfer-list">
                {transfers.map((transfer, index) => (
                  <div key={index} className="transfer-item"
                    style={{
                      padding: '12px',
                      borderBottom: '1px solid rgba(255,255,255,0.1)',
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center'
                    }}
                  >
                    <div>
                      <div style={{ fontWeight: 'bold' }}>
                        {transfer.transfer_type === 'sent' ? 'è½¬å‡º' : 'æ”¶åˆ°'}
                      </div>
                      <div style={{ fontSize: '12px', opacity: 0.8 }}>
                        å¯¹æ–¹: {transfer.counterparty_id}
                      </div>
                      <div style={{ fontSize: '12px', opacity: 0.7 }}>
                        {formatTime(transfer.created_at)}
                      </div>
                    </div>
                    <div style={{
                      color: transfer.transfer_type === 'sent' ? '#f44336' : '#4CAF50',
                      fontWeight: 'bold',
                      fontSize: '16px'
                    }}>
                      {transfer.transfer_type === 'sent' ? '-' : '+'}{transfer.amount}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}
      </div>

      <style jsx>{`
        .modal-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 1000;
        }

        .modal-content {
          background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
          padding: 25px;
          border-radius: 15px;
          width: 90%;
          max-width: 500px;
          max-height: 80vh;
          overflow-y: auto;
        }

        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
        }

        .close-btn {
          background: none;
          border: none;
          color: white;
          font-size: 24px;
          cursor: pointer;
          padding: 0;
          width: 30px;
          height: 30px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .transfer-form .form-group {
          margin-bottom: 15px;
        }

        .transfer-form label {
          display: block;
          margin-bottom: 5px;
          font-weight: bold;
        }

        .transfer-form input {
          width: 100%;
          padding: 10px;
          border: none;
          border-radius: 5px;
          background: rgba(255, 255, 255, 0.9);
          font-size: 14px;
        }

        .transfer-list {
          max-height: 300px;
          overflow-y: auto;
        }
      `}</style>
    </div>
  );
};

export default BalanceManager;

File: frontend/src/components/CardArea.jsx
---
import React from 'react';
import Card from './Card';

const CardArea = ({ title, cards, area, maxCards, onCardMove, gameStatus }) => {
  const handleDrop = (e) => {
    e.preventDefault();
    if (gameStatus !== 'playing') return;

    const cardData = e.dataTransfer.getData('application/json');
    if (!cardData) return;

    try {
      const { card, fromArea } = JSON.parse(cardData);

      if (fromArea !== area) {
        onCardMove(card, fromArea, area);
      }
    } catch (error) {
      console.error('æ‹–æ‹½æ•°æ®è§£æé”™è¯¯:', error);
    }
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    if (gameStatus === 'playing') {
      e.dataTransfer.dropEffect = 'move';
    }
  };

  const getAreaStyle = () => {
    const isFull = cards.length >= maxCards;
    const isValid = cards.length === maxCards;

    return {
      background: isValid ? 'rgba(76, 175, 80, 0.1)' :
                  isFull ? 'rgba(255, 193, 7, 0.1)' : 'rgba(255, 255, 255, 0.1)',
      border: isValid ? '2px solid #4CAF50' :
              isFull ? '2px solid #FFC107' : '2px dashed rgba(255, 255, 255, 0.3)'
    };
  };

  return (
    <div
      className="card-area"
      onDrop={handleDrop}
      onDragOver={handleDragOver}
      style={getAreaStyle()}
    >
      <div className="area-header">
        <h4>{title}</h4>
        <span>
          {cards.length}/{maxCards}
          {cards.length === maxCards && ' âœ“'}
        </span>
      </div>

      <div className="card-slot">
        {cards.map((card, index) => (
          <Card
            key={typeof card === 'object' ? card.filename : `${card}-${index}`}
            card={card}
            area={area}
            draggable={gameStatus === 'playing'}
          />
        ))}
        {cards.length === 0 && (
          <div style={{
            color: 'rgba(255,255,255,0.5)',
            textAlign: 'center',
            width: '100%',
            padding: '20px'
          }}>
            {gameStatus === 'playing' ? 'æ‹–æ”¾æ‰‘å…‹ç‰Œåˆ°æ­¤å¤„' : 'ç­‰å¾…åˆ†é…'}
          </div>
        )}
      </div>
    </div>
  );
};

export default CardArea;

File: frontend/src/App.jsx
---
import React, { useState, useEffect } from 'react'
import Login from './pages/Login'
import Register from './pages/Register'
import MainMenu from './pages/MainMenu'
import GameRoom from './pages/GameRoom'
import { gameAPI } from './utils/api'
import './index.css'

function App() {
  const [currentPage, setCurrentPage] = useState('login')
  const [userInfo, setUserInfo] = useState(null)
  const [selectedRoom, setSelectedRoom] = useState(null)

  // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ç™»å½•çŠ¶æ€
  useEffect(() => {
    const token = localStorage.getItem('token');
    const savedUser = localStorage.getItem('user');

    if (token && savedUser) {
      try {
        const user = JSON.parse(savedUser);
        setUserInfo(user);
        setCurrentPage('main');

        // è®¾ç½®å…¨å±€åˆ·æ–°å‡½æ•°
        window.refreshUserInfo = refreshUserInfo;
      } catch (error) {
        console.error('è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
        localStorage.removeItem('token');
        localStorage.removeItem('user');
      }
    }
  }, []);

  // åˆ·æ–°ç”¨æˆ·ä¿¡æ¯
  const refreshUserInfo = async () => {
    try {
      const result = await gameAPI.getUserInfo();
      if (result.success) {
        setUserInfo(result.user);
        localStorage.setItem('user', JSON.stringify(result.user));
      }
    } catch (error) {
      console.error('åˆ·æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
    }
  };

  const handleLogin = (userData) => {
    setUserInfo(userData);
    setCurrentPage('main');

    // è®¾ç½®å…¨å±€åˆ·æ–°å‡½æ•°
    window.refreshUserInfo = refreshUserInfo;
  };

  const renderPage = () => {
    switch (currentPage) {
      case 'login':
        return <Login onLogin={handleLogin} onNavigate={setCurrentPage} />
      case 'register':
        return <Register onNavigate={setCurrentPage} />
      case 'main':
        return <MainMenu
          userInfo={userInfo}
          onSelectRoom={setSelectedRoom}
          onNavigate={setCurrentPage}
        />
      case 'game':
        return <GameRoom
          roomType={selectedRoom}
          userInfo={userInfo}
          onExit={() => {
            setCurrentPage('main');
            refreshUserInfo();
          }}
        />
      default:
        return <Login onLogin={handleLogin} onNavigate={setCurrentPage} />
    }
  }

  return (
    <div className="app">
      {renderPage()}
    </div>
  )
}

export default App

File: frontend/public/_worker.js
---
export default {
  async fetch(request, env) {
    const url = new URL(request.url);
    const backendBase = 'https://9525.ip-ddns.com';

    // ä»£ç†APIè¯·æ±‚åˆ°åç«¯
    if (url.pathname.startsWith('/api/')) {
      const targetUrl = backendBase + url.pathname + url.search;

      const modifiedRequest = new Request(targetUrl, {
        headers: request.headers,
        method: request.method,
        body: request.body,
        redirect: 'follow'
      });

      // æ·»åŠ CORSå¤´
      const response = await fetch(modifiedRequest);
      const modifiedResponse = new Response(response.body, response);
      modifiedResponse.headers.set('Access-Control-Allow-Origin', '*');
      modifiedResponse.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
      modifiedResponse.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');

      return modifiedResponse;
    }

    // é™æ€èµ„æºè¯·æ±‚ï¼Œç›´æ¥è¿”å›
    return env.ASSETS.fetch(request);
  }
};

File: frontend/public/cards/king_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/5_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/7_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/3_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/4_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/red_joker.svg
---
[SVG Image Content]


File: frontend/public/cards/8_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/jack_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/5_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/5_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/black_joker.svg
---
[SVG Image Content]


File: frontend/public/cards/3_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/3_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/10_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/4_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/ace_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/7_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/6_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/king_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/10_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/4_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/8_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/2_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/king_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/6_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/queen_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/4_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/queen_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/6_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/9_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/7_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/10_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/8_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/ace_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/3_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/jack_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/2_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/9_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/2_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/10_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/8_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/9_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/queen_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/6_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/queen_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/2_of_diamonds.svg
---
[SVG Image Content]


File: frontend/public/cards/king_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/ace_of_clubs.svg
---
[SVG Image Content]


File: frontend/public/cards/ace_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/jack_of_spades.svg
---
[SVG Image Content]


File: frontend/public/cards/jack_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/7_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/5_of_hearts.svg
---
[SVG Image Content]


File: frontend/public/cards/9_of_diamonds.svg
---
[SVG Image Content]


File: frontend/index.html
---
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åä¸‰æ°´æ¸¸æˆ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Arial', sans-serif;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        min-height: 100vh;
      }

      #root {
        min-height: 100vh;
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        font-size: 18px;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <div class="loading">
        åŠ è½½ä¸­...
      </div>
    </div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>